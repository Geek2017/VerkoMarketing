var InfiniteScroll={domain:"Zimbio",scrollingContainer:"#Content",moreButton:"#moreStoriesButton",scrollEle:null,scrollHeight:0,percentDistance:0.5,loading:false,page_number:1,page_limit:4,start:false,mi_guid:"_mi_guid",mi_order:"_mi_order",mobile:false,special_type:"SlideshowSpecial",zine_guid:null,more_specials:false,init:function(a){InfiniteScroll.domain=a.domain||InfiniteScroll.domain;InfiniteScroll.page_number=a.page_number||InfiniteScroll.page_number;InfiniteScroll.page_limit=a.page_limit||InfiniteScroll.page_limit;InfiniteScroll.percentDistance=a.percentDistance||InfiniteScroll.percentDistance;InfiniteScroll.scrollingContainer=a.scrollingContainer||InfiniteScroll.scrollingContainer;InfiniteScroll.zine_guid=a.zine_guid||InfiniteScroll.zine_guid;InfiniteScroll.special_type=a.special_type||InfiniteScroll.special_type;InfiniteScroll.scrollEle=$(InfiniteScroll.scrollingContainer);InfiniteScroll.more_specials=a.more_specials||InfiniteScroll.more_specials;if(a.mobile){InfiniteScroll.mobile=true}InfiniteScroll.startScroll()},checkScroll:function(a){if(InfiniteScroll.loading||!InfiniteScroll.start){return}if(InfiniteScroll.page_number>=InfiniteScroll.page_limit){var b=$(InfiniteScroll.moreButton);if(b.length){b.hide()}return}var c=Browser.getScroll();var d=window.pageYOffset||document.documentElement.scrollTop;InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height();if((1-(d/InfiniteScroll.scrollHeight))<=InfiniteScroll.percentDistance){InfiniteScroll.loading=true;InfiniteScroll.page_number++;InfiniteScroll.loadMore(function(){InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height;InfiniteScroll.loading=false})}},loadMore:function(a){if(InfiniteScroll.more_specials){Zimbio.moreSpecials.setMobileFlag(InfiniteScroll.mobile);Zimbio.moreSpecials.populate(a,InfiniteScroll.page_number,InfiniteScroll.zine_guid)}else{Zimbio.recentStories.setMobileFlag(InfiniteScroll.mobile);Zimbio.recentStories.populate(a)}},startScroll:function(){InfiniteScroll.start=true;InfiniteScroll.scrollHeight=InfiniteScroll.scrollEle.height();$(window).on("scroll",InfiniteScroll.checkScroll)}};AutoComplete=function(d,b,c,a){this.url=a||"/tools/search_auto_complete?editor=1";if(this.url.indexOf("?")===-1){this.url=this.url+"?"}else{this.url=this.url+"&"}this.accepts_multiple=c;this.elementID=d;this.dropdownID=this.elementID+"DropdownID";this.dropdownClass="Penguin";this.wrapperID=this.elementID+"WrapperID";this.loadURLBase=this.url+"js_instance="+b+"&field_id="+this.elementID+"&q=";this.field=$("#"+this.elementID);this.requestCount=0;this.dropDown=false;this.query2="";this.start=-1};AutoComplete.prototype={appendName:function(a){if(this.accepts_multiple){split_array=this.field.val().split(",");split_array.pop();this.field.val(split_array.join(","));if(this.field.val()){this.field.val(this.field.val()+", ")}this.field.val(this.field.val()+a+", ")}else{this.field.val(a)}this.field.blur();this.field.focus();this.field.selectionStart=this.field.val().length;this.dropDown.css("display","none")},getLastInput:function(a){split_array=a.field.val().split(",");return split_array.pop()},init:function(){this.field.on("keyup",this.handleKey(this));this.field.on("change",this.handleKey(this));this.field.on("focus",this.handleKey(this));this.field.on("keydown",this.handleKey(this))},trimQuery:function(a){return a.replace(/^\s+|\s+$/g,"")},keyMovement:function(d,b,e){var c=d.dropDown.find("li");var a=c.length;if(e>=0&&e<a){c[e].attr("class","noHighlight")}if(b>=0&&b<a){var f=c[b];f.attr("class","highlight")}},handleKey:function(a){instanceHandleKey=function(h){if(h.type=="click"){if(a.dropDown&&a.dropDown.css("display","block")){var f=h.target||h.srcElement;if(f.id!="searchResult"&&f.id!=a.elementID){a.dropDown.css("display","none")}}}if(h.type=="focus"&&a.accepts_multiple){if(a.field.val()!=""){if(a.dropDown){a.dropDown.css("display","block")}}}if(h.keyCode==9&&h.type!="keyup"&&a.dropDown.css("display","none")){h.preventDefault?h.preventDefault():h.returnValue=false;var d=a.dropDown.find("li");var c=d.length;if(c>0){var b=d.first().find("a").first();if(b.attr("href")){var g=b.attr("href");document.location=g}else{a.appendName(b.attr("name"))}}}else{if(h.keyCode==40&&h.type!="keyup"){h.preventDefault?h.preventDefault():h.returnValue=false;var d=a.dropDown.find("li");var c=d.length;if(a.start<c-1){a.start++}else{a.start=c-1}a.keyMovement(a,a.start,a.start-1)}else{if(h.keyCode==38&&h.type!="keyup"){h.preventDefault?h.preventDefault():h.returnValue=false;if(a.start>=0){a.start--;if(a.start<-1){a.start=-1}a.keyMovement(a,a.start,a.start+1)}}else{if(h.keyCode==13&&h.type!="keyup"){if(a.start>-1){h.cancelBubble=true;h.returnValue=false;if(h.stopPropagation){h.stopPropagation();h.preventDefault()}elem_list=a.dropDown.find("li");var b=elem_list[a.start].find("a").first();var g=b.attr("href");var i=b.attr("id");if(i){Track.Click.syntheticGet(i)}document.location=g}return true}else{a.triggerEvent(a)}}}}};return instanceHandleKey},triggerEvent:function(b){if(b.accepts_multiple){var c=b.getLastInput(b)}else{var c=b.field.val()}c=b.trimQuery(c);if(c!=b.query2){b.query2=c;var a=b.loadURLBase+encodeURIComponent(c);if(!(c=="")){b.load(b,a,b.dropdownID)}else{if(c==""){if(b.dropDown){b.dropDown.css("display","none")}b.requestCount=0}}}if(b.dropDown){if(b.dropDown.css("display","block")){$("#"+b.dropdownID).on("click","a",b.handleKey(b))}}},load:function(c,b,h){var e=0;var a;c.requestCount++;a=c.requestCount;var f=$("#"+c.dropdownID);if(!(f.length)){obj=$("<div></div>");obj.attr("id",h);obj.css("display","none");var g=$("#"+c.wrapperID);g.append(obj);c.dropDown=$("#"+c.dropdownID)}else{obj=f;obj.css("display","block")}var d=b;$.ajax({type:"GET",url:d}).done(function(i){if(a==c.requestCount){c.start=-1;c.insert(c,obj,i)}}).fail(function(j){if(a==c.requestCount){f.css("display","none");var i=$("#"+c.wrapperID);var k=$("#"+c.dropdownID);$(document).off("click",c.handleKey(c));k.remove()}})},insert:function(b,d,e){d.attr("class",b.dropdownClass);d.css("display","block");d.html(e);var c=d.find("a");for(var b in c){var a=c.eq(b);a.on("click",function(f){Track.Click.syntheticGet(f)})}}};function togglePopout(b){var a=b.next(".popout");if(a.css("display")=="none"){$(".popout").each(function(){if($(this)!=b){$(this).hide();var c=$(this).prev(".popout-title");if(c){c.removeClass("active-bg")}}});a.show();b.addClass("active-bg")}else{a.hide();b.removeClass("active-bg")}}$(document).ready(function(){$(document).click(function(w){var v=$(w.target);var x=$(w.target).attr("id");switch(x){case"see-more-filters":case"see-more-filters-celebs":var u=v.siblings(".filter-sidebar-container");var q=u.height();var t=u.find(".filter-sidebar").height();var s=t/2;if(q<=330){u.animate({"max-height":t+"px"},s);v.attr("placeholder",v.text());v.text("LESS");v.addClass("less")}else{u.animate({"max-height":"330px"},s);var r=v.attr("placeholder");v.text(r);v.removeClass("less")}break;case"reset":window.location=j;break;default:break}});$(".filter-parent label").each(function(){$(this).click(function(){var s=$(this).parent();s.addClass("selected");s.siblings("li").removeClass("selected");var q=$(this).prev("input");var r=q.val();if(r){window.location=r}return false})});$(".popout-title").each(function(){$(this).click(function(q){togglePopout($(this))})});$(".channel-main-filter-btn").on("click",function(){$(".channel-main-filter-dropdown").toggle();$(".channel-main-filter-btn").toggleClass("active")});var b=$(".column"),d=$("#data"),j=d.attr("data-reset-url"),i=d.attr("data-last-guid"),e=d.attr("data-zine-name"),h=d.attr("data-person-name"),o=d.attr("data-total-pictures"),m=d.attr("data-gender"),a=d.attr("data-gender")=="Male"?"men":"women",c=d.attr("data-domain"),f=d.attr("data-is-celebs-main").toLowerCase(),f=f=="false"||f==""||f==null?"":"True",p=d.attr("data-last-celeb"),g=25;function l(q){if(i){$.getJSON("/tools/api",{filters:e+","+i+","+(h?h+",":"")+a,method:"media.product_tag.get_tiles",image_sizes:"m",count:g,offset:1,zine_name:e,is_celebs_main:f,last_celeb:p,total_pictures:o||0}).done(function(x){var s=x.tiles;var w=$(b[0]);for(var u=0,r=s.length;u<r;u++){var v=w.height();b.each(function(){var z=$(this).height();var A=$(this).position().top;z=z+A;if(z<v){w=$(this);v=z}});var y=$('<div class="tile-wrapper">'+s[u]+"</div>");img=y.find("img");var t=y.height();y.hide();w.append(y);w.height(w.height+t);img.ready(function(){y.fadeIn("slow")});p=y.find(".tile-container").attr("data-person-name")}q();i=x.last_guid})}}var n=InfiniteScroll;n.loadMore=l;l(function(){InfiniteScroll.init({domain:c,scrollingContainer:"Content",percentDistance:0.5,page_number:1,page_limit:10000})});var k=d.attr("data-celeb-filter-url");celebFilter=new AutoComplete("celeb_filter_id","celebFilter",false,k);celebFilter.init()});